package game

import (
	"encoding/json"
	"fmt"
	"io/ioutil"
)

// Ascii art of the npcs
var ShopkeeperArt string = `
⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣀⢀⣀⣀⣀⣀⡀⣀⣀⢀⣀⢀⣀⡀⣀⡀⣀⣀⣀⣀⣀⡀⣀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢘⣶⣏⣳⡬⢛⣿⣿⣻⣽⣯⣭⣽⣖⣿⣾⣷⡤⡠⠩⢻⣿⣿⣿⣿⡿⢉⣿⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠨⣿⣛⣿⣯⣹⣾⣽⣿⣽⢛⡻⢿⡿⢿⣮⣽⠳⣤⢚⡮⣿⣿⣿⣿⢻⠿⣿⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢐⣯⣿⣿⣿⣿⣽⣿⣺⢿⣭⣖⣯⡽⣛⠊⠁⠺⢙⣯⠖⠋⣿⣿⣿⣿⣶⣿⣿⣿⣿⣿⣶⠀
⠀⠀⠀⠀⠀⢨⣿⣻⡿⣿⣿⣿⣷⣏⠎⡁⠛⠐⢠⠙⡰⠐⠀⢼⡟⣿⠀⢺⣿⣿⣿⣿⣿⣿⣼⣿⡿⣿⠁
⠀⠀⠀⠀⠀⠸⣱⢻⠉⡰⠟⡯⡙⠅⢂⠠⣄⡱⠋⠠⢁⠁⢀⣼⣿⠓⠀⠈⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀
⠀⠀⠀⠀⠀⢀⣿⣟⣁⡀⣴⣥⣷⣾⣦⣤⡿⣷⣤⣐⢯⣴⣿⣿⡯⠀⠀⣐⠈⢿⣿⣿⣿⣿⣿⣿⣿⣿⡄
⠀⠀⠀⠀⠀⢸⡏⠐⠺⣧⠿⡿⣿⢿⣿⣿⣿⣛⡿⢿⡿⡿⠿⣉⡴⣰⣶⣤⣶⣼⣿⣿⣿⣿⣿⣿⣿⣿⡀
⠀⠀⠀⠀⠀⠸⠁⠀⢀⡡⢆⡱⣜⣎⢶⣹⣛⠱⡘⠩⡔⡩⢲⠱⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠂
⠀⠀⠀⠀⠀⠀⠂⣔⣬⣭⣾⣽⣿⣾⢷⣳⢮⡑⡀⠁⠀⠡⢂⡳⣽⢯⡿⣭⢏⢭⡙⠿⣿⣿⣿⣿⣷⠀⠀
⠒⠀⠀⠀⠀⠀⡘⠙⡟⣻⣿⣿⢯⣿⡿⢯⢒⠑⠀⠀⠀⠀⢡⢻⣽⢿⣻⣟⣻⣚⣧⣿⣜⣿⣿⣿⡇⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⡸⢾⣉⡿⡎⢷⠁⠆⠀⠀⠀⠀⠀⠀⢏⡾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀
⠀⠀⠀⠀⠀⠂⠀⠀⠀⠀⠈⠁⠘⠈⠀⠀⠀⠀⠀⠀⠀⠀⠈⡜⢲⣓⠾⣽⣿⣿⡿⣿⢿⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⢌⢣⢎⠳⢌⡱⢊⠕⡊⢽⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠲⣌⢓⠢⠰⡁⢎⠰⡈⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠦⡙⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠡⠙⢦⠉⢆⠱⠠⡁⠄⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⡔⠀⠀⠀⠀⢆⡱⢊⠝⡃⠀⠀⠀⠀⠀⢠⠐⠤⡁⣔⡡⢆⠂⣍⠢⢌⢡⠡⢰⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⡆⠀⠀⠀⠘⠤⠁⠉⠀⠀⠀⠐⠢⣥⡘⢤⣋⣷⡹⢶⣽⣎⠳⣀⠣⢌⡘⣡⡃⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⡃⠀⠀⠀⠈⠀⠀⠀⣠⠐⣀⡐⠀⢶⣹⢷⣛⣶⣿⣿⣿⣿⣷⣤⡃⢆⡜⡹⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠅⠀⠀⠠⣤⣏⡶⣏⡕⢺⢇⣲⡩⢖⣿⣿⢿⣿⢿⣿⣿⣿⣿⣿⣿⣷⡸⡅⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣃⠀⠈⠟⣹⣾⣿⣡⢃⠼⣂⠋⡕⣫⠙⣜⢫⡙⣫⣝⣯⣽⣹⣟⣿⣿⢷⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢐⠀⠉⢘⠣⠏⠉⠿⢻⠿⣿⣿⣿⣿⣿⣶⣷⣿⣿⣿⣿⡿⣟⢫⠳⣯⠏⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠘⡂⠀⠀⠀⠀⠀⠀⠀⠠⠉⠙⡹⢻⣿⠿⣿⢽⡻⣿⡱⣏⠇⣎⢳⡽⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠛⠀⠀⠀⠀⠀⠀⠀⠀⢄⢣⣝⡳⣜⡻⣬⢳⡟⣶⢛⣜⡺⣬⠷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⡎⠀⠀⠀⠂⠄⢂⠴⡰⣌⣾⣾⣽⣯⣷⣯⢷⡻⡵⣯⢞⣳⡽⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠐⡅⠀⠀⠀⠀⠈⢢⠹⣵⣻⣾⣿⣿⣿⣿⡿⣯⢻⡵⣫⢟⣵⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢡⠀⠂⠀⠀⠀⠀⠑⡬⠿⣽⢻⣿⡿⣽⣻⣭⢷⣩⢗⣯⠖⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
`

var BlacksmithArt string = `
⡋⠐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⢀⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠁⣠⠈⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⣶⣷⣾⣿⣿⣿⣿⣿⣶⣄⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣆⣀⡄⠀⠀⠀⠀⠀⠀⣀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠛⠿⠿⣶⣷⣤⣦⣀⣰⣿⣿⣿⣿⠿⠛⠛⠛⠛⠛⠛⠛⠿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣤⣶⣦⣥⣶⣤⣌⣩⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⢿⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠁⠀⠀⠀⠀⠀⠉⠉⢹⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣿⢁⣠⣤⣤⣴⣶⣄⠀⠀⠀⢦⣶⣿⣷⣶⣶⣦⣸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣷⣿⠿⠋⠉⠛⠛⠛⠀⠀⠀⠘⠋⢉⣄⡀⠀⠘⠻⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠩⠀⣠⣴⣶⣶⣦⠀⠀⠀⠀⠀⠰⢿⠿⣿⣷⣥⡀⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⡄⠐⠉⠉⠹⠟⠀⠀⠀⠀⠀⠀⠀⠈⠉⠀⠐⠀⠀⠸⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣴⣶⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡀⢀⢆⠀⠀⠀⠀⠈⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⢿⠀⠀⠀⠀⠀⠑⢿⣟⢣⣠⣽⣉⡋⠀⠣⡀⠀⠀⠀⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠘⡆⠀⠀⠀⢀⣴⡿⠿⡿⠿⡿⠻⠿⢿⣶⢲⡄⠀⢠⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⠀⠰⠾⣟⣿⣶⣿⠟⣟⠛⣛⣿⣶⡾⠁⠇⠀⠘⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢁⠀⠀⠈⠉⠋⢻⢿⣿⣿⣿⠽⠋⠀⠀⠀⢠⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣀⣀⡀⢤⣤⡼⠀⠀⠀⠀⠀⠉⠙⠉⡿⠅⠀⠀⠀⠀⢠⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⢀⣴⠾⠛⡋⠠⣔⡞⡽⣾⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡙⣦⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀
⠾⡛⠠⠒⠉⣠⣼⠋⡶⠳⣿⠀⠀⠀⠢⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣷⣼⣀⣯⠑⠢⢀⠀⠀⠀⠀⠀
⢿⣆⢀⠄⣽⣣⡇⢸⡇⠄⣿⠀⠀⠀⠀⠘⠂⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣵⡰⡤⡹⣷⣄⡀⠀
⠿⠿⠷⠧⠻⠛⠀⠈⠒⠰⠾⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠇⠹⠯⠝⠓⠇⠛⠿⠿⠫⠙⠿⠦
`

type Npc struct {
	Name    string
	Intro   string
	NpcShop *Shop
}

func InitNpc(name string, shop *Shop) *Npc {
	var npc *Npc = new(Npc)
	npc.Name = name
	npc.NpcShop = shop
	return npc
}

// Parse the json file and put items in a global map
// range on the sells of the npc to take the value
// of the items in item list and only create 1 object in memory to be used everywhere
func InitNpcs() {
	Npcs = make(map[string]*Npc, 0)

	filename := "../config/npcs.json"
	content, err := ioutil.ReadFile(filename)
	if err != nil {
		fmt.Println("Error parsing file", filename, err)
	}

	var payload map[string][]*Npc
	err = json.Unmarshal(content, &payload)
	if err != nil {
		fmt.Println("Error Unmarshal()", filename, err)
	}

	for _, npc := range payload["Npcs"] {
		Npcs[npc.Name] = npc
		for _, sell := range npc.NpcShop.Sells {
			for _, item := range Items {
				if sell.ShopItem.Name == item.Name {
					sell.ShopItem = &(*item)
					break
				}
			}
		}
	}
}
